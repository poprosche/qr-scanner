{"version":3,"sources":["components/Modal.js","App.jsx","index.js"],"names":["Modal","_ref","activeModal","currentTitle","currentCaption","actionFlag","onCloseModal","onAction","currentButtonText","react_default","a","createElement","es6","id","onClose","title","caption","actions","type","action","GROUP_ID","group_id","COMMUNITY_ACCESS_TOKEN","access_token","APP_ACCESS_TOKEN","VERSION","v","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","startScanFlow","openQRScanner","handleQRResult","asyncToGenerator","regenerator_default","mark","_callee","QRResult","_args","arguments","wrap","_context","prev","next","length","undefined","setState","sendQRResult","stop","_callee2","_this$state","fetchedUser","_context2","state","axios","get","qr","user","QRSuccessModal","t0","console","log","activateModal","closeModal","joinToGroup","connect","send","setTimeout","handleModalAction","flag","joinGroup","qrSuccess","activateJoinGroupModal","memberCheck","method","request_id","params","objectSpread","user_id","messagesAllowedCheck","activePanel","_this2","subscribe","_ref4","_callee3","_ref3","detail","_context3","data","abrupt","result","qr_data","response","is_allowed","_x","apply","_this$state2","before","photo_200","src","description","city","concat","first_name","last_name","onClick","size","level","components_Modal","React","Component","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.a3698838.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport {ModalRoot, ModalCard} from '@vkontakte/vkui';\r\n\r\nconst Modal = ({activeModal, currentTitle, currentCaption, actionFlag, onCloseModal, onAction, currentButtonText}) => (\r\n    <ModalRoot activeModal={activeModal}>\r\n        <ModalCard\r\n            id={'MY_MODAL'}\r\n            onClose={() => onCloseModal()}\r\n            title={currentTitle}\r\n            caption={currentCaption}\r\n            actions={[{\r\n                title: currentButtonText,\r\n                type: 'primary',\r\n                action: () => onAction(actionFlag)\r\n            }]}\r\n        >\r\n        </ModalCard>\r\n    </ModalRoot>\r\n);\r\n\r\nexport default Modal;\r\n","import React from 'react';\nimport connect from '@vkontakte/vkui-connect';\nimport {\n  Avatar,\n  Group,\n  ListItem,\n  Panel,\n  PanelHeader,\n  View,\n  Button,\n} from '@vkontakte/vkui';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport axios from 'axios';\n\nimport Modal from './components/Modal';\n\nconst GROUP_ID = { group_id: 185199781 };\nconst COMMUNITY_ACCESS_TOKEN = {\n  access_token:\n    '9b1957fb4a56d227f2d894046db9b8aa12b7dafbbf6f606c0f7af580dcc06cf12862881c158bc4cf82e09',\n};\nconst APP_ACCESS_TOKEN = {\n  access_token:\n    '59f1b2e059f1b2e059f1b2e0c5599da582559f159f1b2e004b9e79590e7db44bab8b30c',\n};\nconst VERSION = { v: '5.101' };\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      activePanel: 'home',\n      fetchedUser: null,\n      activeModal: null,\n      QRResult: null,\n      currentTitle: '',\n      currentCaption: '',\n      actionFlag: '',\n    };\n  }\n\n  componentDidMount() {\n    this.startScanFlow();\n    connect.subscribe(async ({ detail }) => {\n      switch (detail.type) {\n        case 'VKWebAppGetUserInfoResult':\n          this.setState({ fetchedUser: detail.data });\n          this.memberCheck();\n          this.messagesAllowedCheck();\n          break;\n        case 'VKWebAppAllowMessagesFromGroupResult':\n          if (\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\n            && detail.data.result\n          ) {\n            this.QRSuccessModal();\n          }\n          break;\n        case 'VKWebAppJoinGroupResult':\n          if (detail.data.result) {\n            this.sendQRResult();\n          }\n          break;\n        case 'VKWebAppOpenQRResult':\n          if (!detail.data.qr_data) {\n            this.startScanFlow();\n          }\n          this.handleQRResult(detail.data.qr_data);\n          break;\n        case 'VKWebAppOpenQRFailed':\n          this.startScanFlow();\n          break;\n\n        // METHODS\n        case 'VKWebAppCallAPIMethodResult':\n          if (\n            detail.data.request_id === 'groups.isMember'\n            && detail.data.response === 0\n          ) {\n            this.activateJoinGroupModal();\n          }\n          if (\n            detail.data.request_id === 'groups.isMember'\n            && detail.data.response === 1\n          ) {\n            this.sendQRResult();\n          }\n\n          if (\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\n            && detail.data.response.is_allowed === 1\n          ) {\n            this.QRSuccessModal();\n          }\n          if (\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\n            && detail.data.response.is_allowed === 0\n          ) {\n            connect.send('VKWebAppAllowMessagesFromGroup', {\n              request_id: 'messages.isMessagesFromGroupAllowed',\n              ...GROUP_ID,\n            });\n          }\n          break;\n        default:\n          break;\n      }\n    });\n    connect.send('VKWebAppGetUserInfo', {});\n  }\n\n  startScanFlow = () => {\n    this.openQRScanner();\n  };\n\n  handleQRResult = async (QRResult = '1111111') => {\n    this.setState({ QRResult });\n\n    this.sendQRResult(QRResult);\n  };\n\n  sendQRResult = async () => {\n    const { QRResult, fetchedUser } = this.state;\n\n    try {\n      await axios.get('https://reqres.in/api/users', {\n        qr: QRResult,\n        user: fetchedUser,\n      });\n\n      this.QRSuccessModal();\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  activateModal = () => {\n    this.setState({ activeModal: 'MY_MODAL' });\n  };\n\n  closeModal = () => {\n    this.setState({ activeModal: null });\n  };\n\n  joinToGroup = () => {\n    connect.send('VKWebAppJoinGroup', GROUP_ID);\n  };\n\n  openQRScanner = () => {\n    setTimeout(() => {\n      connect.send('VKWebAppOpenQR', {});\n    }, 300);\n  };\n\n  handleModalAction = (flag) => {\n    this.closeModal();\n    const flagMap = {\n      joinGroup: () => this.joinToGroup(),\n      qrSuccess: () => this.openQRScanner(),\n    };\n    flagMap[flag]();\n  };\n\n  activateJoinGroupModal = () => {\n    this.setState({\n      currentTitle: 'Вступление в группу',\n      currentCaption: 'Для начисления балов подпишитесь на группу и рассылку',\n      currentButtonText: 'Вступить',\n      actionFlag: 'joinGroup',\n    });\n    this.activateModal();\n  };\n\n  QRSuccessModal = () => {\n    this.setState({\n      currentTitle: 'Чек успешно отправлен',\n      currentCaption: 'В ближайшее время мы выполним проверку и начислим балы',\n      currentButtonText: 'Сканировать еще',\n      actionFlag: 'qrSuccess',\n    });\n    this.activateModal();\n  };\n\n  memberCheck = () => {\n    const { fetchedUser } = this.state;\n\n    connect.send('VKWebAppCallAPIMethod', {\n      method: 'groups.isMember',\n      request_id: 'groups.isMember',\n      params: {\n        user_id: fetchedUser.id,\n        ...GROUP_ID,\n        ...APP_ACCESS_TOKEN,\n        ...VERSION,\n      },\n    });\n  };\n\n  messagesAllowedCheck = () => {\n    const { fetchedUser } = this.state;\n\n    connect.send('VKWebAppCallAPIMethod', {\n      method: 'messages.isMessagesFromGroupAllowed',\n      request_id: 'messages.isMessagesFromGroupAllowed',\n      params: {\n        request_id: 'messages.isMessagesFromGroupAllowed',\n        user_id: fetchedUser.id,\n        ...COMMUNITY_ACCESS_TOKEN,\n        ...VERSION,\n        ...GROUP_ID,\n      },\n    });\n  };\n\n  render() {\n    const {\n      fetchedUser,\n      activeModal,\n      currentTitle,\n      currentCaption,\n      actionFlag,\n      currentButtonText,\n      activePanel,\n    } = this.state;\n\n    return (\n      <View activePanel={activePanel}>\n        <Panel id=\"home\">\n          <PanelHeader>Scanner</PanelHeader>\n\n          {fetchedUser && (\n            <Group title=\"Welcome\">\n              <ListItem\n                before={\n                  fetchedUser.photo_200 ? (\n                    <Avatar src={fetchedUser.photo_200} />\n                  ) : null\n                }\n                description={\n                  fetchedUser.city && fetchedUser.city.title\n                    ? fetchedUser.city.title\n                    : ''\n                }\n              >\n                {`${fetchedUser.first_name} ${fetchedUser.last_name}`}\n              </ListItem>\n            </Group>\n          )}\n\n          <Button onClick={this.startScanFlow} size=\"xl\" level=\"primary\">\n            Зарегистрировать чек\n          </Button>\n\n          <Modal\n            activeModal={activeModal}\n            currentTitle={currentTitle}\n            currentCaption={currentCaption}\n            actionFlag={actionFlag}\n            currentButtonText={currentButtonText}\n            onCloseModal={this.closeModal}\n            onAction={this.handleModalAction}\n          />\n        </Panel>\n      </View>\n    );\n  }\n}\n\nexport default App;\n","import 'core-js/es6/map';\r\nimport 'core-js/es6/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vkui-connect';\r\nimport App from './App';\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK App\r\nconnect.send('VKWebAppInit', {});\r\nconsole.log('kek', connect.send(\"VKWebAppGetUserInfo\", {}))\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT \r\n// registerServiceWorker();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}