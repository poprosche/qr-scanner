{"version":3,"sources":["components/Modal.js","App.jsx","index.js"],"names":["Modal","_ref","activeModal","currentTitle","currentCaption","actionFlag","onCloseModal","onAction","currentButtonText","react_default","a","createElement","es6","id","onClose","title","caption","actions","type","action","GROUP_ID","group_id","COMMUNITY_ACCESS_TOKEN","access_token","APP_ACCESS_TOKEN","VERSION","v","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","startScanFlow","openQRScanner","handleQRResult","asyncToGenerator","regenerator_default","mark","_callee","QRResult","_args","arguments","wrap","_context","prev","next","length","undefined","setState","sendQRResult","stop","_callee2","_this$state","fetchedUser","_context2","state","axios","get","qr","user","QRSuccessModal","t0","console","log","activateModal","closeModal","joinToGroup","connect","send","setTimeout","handleModalAction","flag","joinGroup","qrSuccess","activateJoinGroupModal","memberCheck","method","request_id","params","objectSpread","user_id","messagesAllowedCheck","activePanel","_this2","subscribe","_ref4","_callee3","_ref3","detail","_context3","data","abrupt","result","qr_data","response","is_allowed","_x","apply","_this$state2","before","photo_200","src","description","city","concat","first_name","last_name","onClick","size","level","components_Modal","React","Component","ReactDOM","render","src_App","document","getElementById"],"mappings":"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","file":"static/js/main.f732a592.chunk.js","sourcesContent":["import React from 'react';\r\n\r\nimport {ModalRoot, ModalCard} from '@vkontakte/vkui';\r\n\r\nconst Modal = ({activeModal, currentTitle, currentCaption, actionFlag, onCloseModal, onAction, currentButtonText}) => (\r\n    <ModalRoot activeModal={activeModal}>\r\n        <ModalCard\r\n            id={'MY_MODAL'}\r\n            onClose={() => onCloseModal()}\r\n            title={currentTitle}\r\n            caption={currentCaption}\r\n            actions={[{\r\n                title: currentButtonText,\r\n                type: 'primary',\r\n                action: () => onAction(actionFlag)\r\n            }]}\r\n        >\r\n        </ModalCard>\r\n    </ModalRoot>\r\n);\r\n\r\nexport default Modal;\r\n","import React from 'react';\r\nimport connect from '@vkontakte/vkui-connect';\r\nimport {\r\n  Avatar,\r\n  Group,\r\n  ListItem,\r\n  Panel,\r\n  PanelHeader,\r\n  View,\r\n  Button,\r\n} from '@vkontakte/vkui';\r\nimport '@vkontakte/vkui/dist/vkui.css';\r\nimport axios from 'axios';\r\n\r\nimport Modal from './components/Modal';\r\n\r\nconst GROUP_ID = { group_id: 185199781 };\r\nconst COMMUNITY_ACCESS_TOKEN = {\r\n  access_token:\r\n    '9b1957fb4a56d227f2d894046db9b8aa12b7dafbbf6f606c0f7af580dcc06cf12862881c158bc4cf82e09',\r\n};\r\nconst APP_ACCESS_TOKEN = {\r\n  access_token:\r\n    '59f1b2e059f1b2e059f1b2e0c5599da582559f159f1b2e004b9e79590e7db44bab8b30c',\r\n};\r\nconst VERSION = { v: '5.101' };\r\n\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      activePanel: 'home',\r\n      fetchedUser: null,\r\n      activeModal: null,\r\n      QRResult: null,\r\n      currentTitle: '',\r\n      currentCaption: '',\r\n      actionFlag: '',\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.startScanFlow();\r\n    connect.subscribe(async ({ detail }) => {\r\n      switch (detail.type) {\r\n        case 'VKWebAppGetUserInfoResult':\r\n          this.setState({ fetchedUser: detail.data });\r\n          this.memberCheck();\r\n          this.messagesAllowedCheck();\r\n          break;\r\n        case 'VKWebAppAllowMessagesFromGroupResult':\r\n          if (\r\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\r\n            && detail.data.result\r\n          ) {\r\n            this.QRSuccessModal();\r\n          }\r\n          break;\r\n        case 'VKWebAppJoinGroupResult':\r\n          if (detail.data.result) {\r\n            this.sendQRResult();\r\n          }\r\n          break;\r\n        case 'VKWebAppOpenQRResult':\r\n          if (detail.data.qr_data) {\r\n            this.handleQRResult(detail.data.qr_data);\r\n          }\r\n          break;\r\n\r\n        // METHODS\r\n        case 'VKWebAppCallAPIMethodResult':\r\n          if (\r\n            detail.data.request_id === 'groups.isMember'\r\n            && detail.data.response === 0\r\n          ) {\r\n            this.activateJoinGroupModal();\r\n          }\r\n          if (\r\n            detail.data.request_id === 'groups.isMember'\r\n            && detail.data.response === 1\r\n          ) {\r\n            this.sendQRResult();\r\n          }\r\n\r\n          if (\r\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\r\n            && detail.data.response.is_allowed === 1\r\n          ) {\r\n            this.QRSuccessModal();\r\n          }\r\n          if (\r\n            detail.data.request_id === 'messages.isMessagesFromGroupAllowed'\r\n            && detail.data.response.is_allowed === 0\r\n          ) {\r\n            connect.send('VKWebAppAllowMessagesFromGroup', {\r\n              request_id: 'messages.isMessagesFromGroupAllowed',\r\n              ...GROUP_ID,\r\n            });\r\n          }\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n    connect.send('VKWebAppGetUserInfo', {});\r\n  }\r\n\r\n  startScanFlow = () => {\r\n    this.openQRScanner();\r\n  };\r\n\r\n  handleQRResult = async (QRResult = '1111111') => {\r\n    this.setState({ QRResult });\r\n\r\n    this.sendQRResult(QRResult);\r\n  };\r\n\r\n  sendQRResult = async () => {\r\n    const { QRResult, fetchedUser } = this.state;\r\n\r\n    try {\r\n      await axios.get('https://reqres.in/api/users', {\r\n        qr: QRResult,\r\n        user: fetchedUser,\r\n      });\r\n\r\n      this.QRSuccessModal();\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  activateModal = () => {\r\n    this.setState({ activeModal: 'MY_MODAL' });\r\n  };\r\n\r\n  closeModal = () => {\r\n    this.setState({ activeModal: null });\r\n  };\r\n\r\n  joinToGroup = () => {\r\n    connect.send('VKWebAppJoinGroup', GROUP_ID);\r\n  };\r\n\r\n  openQRScanner = () => {\r\n    setTimeout(() => {\r\n      connect.send('VKWebAppOpenQR', {});\r\n    }, 300);\r\n  };\r\n\r\n  handleModalAction = (flag) => {\r\n    this.closeModal();\r\n    const flagMap = {\r\n      joinGroup: () => this.joinToGroup(),\r\n      qrSuccess: () => this.openQRScanner(),\r\n    };\r\n    flagMap[flag]();\r\n  };\r\n\r\n  activateJoinGroupModal = () => {\r\n    this.setState({\r\n      currentTitle: 'Вступление в группу',\r\n      currentCaption: 'Для начисления балов подпишитесь на группу и рассылку',\r\n      currentButtonText: 'Вступить',\r\n      actionFlag: 'joinGroup',\r\n    });\r\n    this.activateModal();\r\n  };\r\n\r\n  QRSuccessModal = () => {\r\n    this.setState({\r\n      currentTitle: 'Чек успешно отправлен',\r\n      currentCaption: 'В ближайшее время мы выполним проверку и начислим балы',\r\n      currentButtonText: 'Сканировать еще',\r\n      actionFlag: 'qrSuccess',\r\n    });\r\n    this.activateModal();\r\n  };\r\n\r\n  memberCheck = () => {\r\n    const { fetchedUser } = this.state;\r\n\r\n    connect.send('VKWebAppCallAPIMethod', {\r\n      method: 'groups.isMember',\r\n      request_id: 'groups.isMember',\r\n      params: {\r\n        user_id: fetchedUser.id,\r\n        ...GROUP_ID,\r\n        ...APP_ACCESS_TOKEN,\r\n        ...VERSION,\r\n      },\r\n    });\r\n  };\r\n\r\n  messagesAllowedCheck = () => {\r\n    const { fetchedUser } = this.state;\r\n\r\n    connect.send('VKWebAppCallAPIMethod', {\r\n      method: 'messages.isMessagesFromGroupAllowed',\r\n      request_id: 'messages.isMessagesFromGroupAllowed',\r\n      params: {\r\n        request_id: 'messages.isMessagesFromGroupAllowed',\r\n        user_id: fetchedUser.id,\r\n        ...COMMUNITY_ACCESS_TOKEN,\r\n        ...VERSION,\r\n        ...GROUP_ID,\r\n      },\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const {\r\n      fetchedUser,\r\n      activeModal,\r\n      currentTitle,\r\n      currentCaption,\r\n      actionFlag,\r\n      currentButtonText,\r\n      activePanel,\r\n    } = this.state;\r\n\r\n    return (\r\n      <View activePanel={activePanel}>\r\n        <Panel id=\"home\">\r\n          <PanelHeader>Scanner</PanelHeader>\r\n\r\n          {fetchedUser && (\r\n            <Group title=\"Welcome\">\r\n              <ListItem\r\n                before={\r\n                  fetchedUser.photo_200 ? (\r\n                    <Avatar src={fetchedUser.photo_200} />\r\n                  ) : null\r\n                }\r\n                description={\r\n                  fetchedUser.city && fetchedUser.city.title\r\n                    ? fetchedUser.city.title\r\n                    : ''\r\n                }\r\n              >\r\n                {`${fetchedUser.first_name} ${fetchedUser.last_name}`}\r\n              </ListItem>\r\n            </Group>\r\n          )}\r\n\r\n          <Button onClick={this.startScanFlow} size=\"xl\" level=\"primary\">\r\n            Зарегистрировать чек\r\n          </Button>\r\n\r\n          <Modal\r\n            activeModal={activeModal}\r\n            currentTitle={currentTitle}\r\n            currentCaption={currentCaption}\r\n            actionFlag={actionFlag}\r\n            currentButtonText={currentButtonText}\r\n            onCloseModal={this.closeModal}\r\n            onAction={this.handleModalAction}\r\n          />\r\n        </Panel>\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import 'core-js/es6/map';\r\nimport 'core-js/es6/set';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport connect from '@vkontakte/vkui-connect';\r\nimport App from './App';\r\n// import registerServiceWorker from './sw';\r\n\r\n// Init VK App\r\nconnect.send('VKWebAppInit', {});\r\nconsole.log('kek', connect.send(\"VKWebAppGetUserInfo\", {}))\r\n\r\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\r\n// расскомментируйте строку с registerServiceWorker();\r\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\r\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT \r\n// registerServiceWorker();\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n"],"sourceRoot":""}